# Notify Module - Filament v4 Upgrade Notes

This document outlines specific considerations and changes for the `Notify` module during the Filament v4 upgrade. For a comprehensive overview of the Filament v4 upgrade process, refer to the main project documentation: [`docs/filament_v4_upgrade.md`](../../docs/Filament_Upgrade_v4.md).

## **Key Changes and Action Items for `Notify` Module**

### **1. `SvgNotFound` Error Resolution (`contact.blade.php`)**

*   **Issue:** The application was throwing `BladeUI\Icons\Exceptions\SvgNotFound` for `Svg by name "notify::contact_type_enum.notes.icon"`. This error occurred in `Modules/Notify/resources/views/filament/tables/columns/contact.blade.php` when attempting to render an icon using `<x-filament::icon :icon="$contact_type->getIcon()" />`.
*   **Root Cause (Suspected):** The `notify::` prefix suggests a custom icon set for the `Notify` module, whose registration or the `Blade UI Kit` itself might be compromised due to the project's unresolved Composer dependencies. The icon name `notify::contact_type_enum.notes.icon` is dynamically generated by `ContactTypeEnum::getIcon()`, likely via the `TransTrait`.
*   **Temporary Workaround:** To prevent application crashes and allow rendering, the problematic icon rendering line in `contact.blade.php` has been replaced with a hardcoded generic Heroicon: `<x-heroicon-o-chat-bubble-oval-left-ellipsis />`.
*   **Permanent Solution (Post-Composer Fix):** Once Composer dependencies are resolved, the following steps are required:
    1.  Ensure `Blade UI Kit` and any custom icon sets are properly installed and registered.
    2.  Verify the `TransTrait` and `ContactTypeEnum::getIcon()` correctly generate the intended icon names.
    3.  Revert the temporary change in `contact.blade.php` and test the dynamic icon rendering.

### **2. Spatie Translatable Plugin Deprecation**

*   **Issue:** The official `spatie/laravel-translatable` plugin is deprecated in Filament v4.
*   **Action Required:** If the `Notify` module (or any other part of the application) relies on the official Spatie Translatable Plugin, it must be replaced with `lara-zeus/spatie-translatable`.
    *   The automated Filament v4 upgrade script *should* handle this replacement in `composer.json` and code references.
    *   **Post-Composer Fix:** Manually verify that the replacement has occurred and that all translatable fields in `Notify` (and other modules) continue to function correctly with the new plugin.

### **3. Custom Component `make()` Method Overrides**

*   **Issue:** Filament v4 introduces a new recommended pattern for custom components that override the static `make()` method.
    *   If `make()` was overridden to provide a default name, it's now recommended to override `getDefaultName()` instead.
    *   If `make()` was overridden to provide default configuration, it's now recommended to override the `setUp()` method instead.
*   **Action Required:** Review `Notify` module's custom Filament components (if any, in addition to `ContactTypeEnum` itself) for `make()` method overrides. Refactor them to use `getDefaultName()` or `setUp()` as appropriate to maintain compatibility and reduce future maintenance burden.

### **4. Adherence to Laraxot `XotBaseSection` Rule**

*   **Rule:** According to Laraxot philosophy, all custom Filament Section components **must extend `Modules\Xot\Filament\Schemas\Components\XotBaseSection`** instead of directly extending `Filament\Schemas\Components\Section`. This ensures architectural consistency and leverages shared `XotBaseSection` functionalities.

*   **Status:** `ContactSection` (`Modules\Notify\Filament\Forms\Components\ContactSection.php`) already correctly extends `XotBaseSection`.

### **5. Resolution of `BadMethodCallException` (`disableLiveUpdates`)**

*   **Issue:** A `BadMethodCallException` occurred, indicating that `disableLiveUpdates()` was being called on a component that did not possess this method in Filament v4. This was resolved by adding a compatibility shim (empty `public function disableLiveUpdates(): static`) to `Modules\Xot\Filament\Schemas\Components\XotBaseSection.php`. This fix ensures smooth operation of `ContactSection` and other `XotBaseSection`-derived components.

### **6. Filament v4 Section Component Behavior (`columnSpanFull`)**

*   **Issue:** In Filament v3, `Section` components automatically spanned the full width of their parent grid. In Filament v4, `Section` components now only consume one column by default.

*   **Action Required:** Review all instances where `ContactSection` is used within `Notify` module forms. If a `ContactSection` is intended to span the full width, the `->columnSpanFull()` method must be explicitly called on its instance.

    ```php

    use Modules\Notify\Filament\Forms\Components\ContactSection;

    // ... in your form schema

    ContactSection::make('contact')

        ->columnSpanFull(),

    ```

    For a global return to v3 behavior, this can be configured in a service provider (e.g., `AppServiceProvider`):

    ```php

    use Filament\Schemas\Components\Section;

    Section::configureUsing(fn (Section $section) => $section->columnSpanFull());

    ```
